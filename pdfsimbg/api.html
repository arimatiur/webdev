<script>

			

	let checkedPDFs = new Set();
	window.onload = function () {
		const clearButton = document.getElementById("clear-button");
		clearButton.addEventListener("click", () => {
			clearTableBody(checkedPDFs);
			checkedPDFs.clear();
		});

		const searchButton = document.getElementById("searchButton");
		searchButton.addEventListener("click", () => {
			// const apiList =
			// 	"http://10.1.2.103///apijakartasatu/web/simbg-file/list?pbgid=";
			
			
			var idPBG = document.getElementById("filterInput").value;
			// const urlApi = "http://10.1.2.103///apijakartasatu/web-dev/simbg-file/list?pbgid="+idPBG+"&scode="+"161025c00c7941a4a29edd8d3eur1simba69159";
			
			

			// console.log(Flask.url_for("simbg_list", {idfilenew : "pbg-317302-15032023-03"}));
			
			
			// console.log(String(/back/simbg-file/list)+idPBG+"&scode="+jakartasatudatadev-89b4052cb0f945fa8db0ec17cexpbg019138e);
			// const urlApi = { url_for('simbg_file_test1',pbgid = idPBG)};
			// const tableTBody = document.getElementById("table-body");
			// const text1 =
			// 	"http://10.1.2.103///apijakartasatu/web-dev/simbg-file/file?doc=";
			// const text2 = "&sudin=";

			checkedPDFs.clear();

			async function api(checkedPDFs) {
				try {
					// const response = await fetch(urlApi);
					// const data = await response.json();
					
					const data = function () {
						var tmp = null;
						$.ajax({
							'async': false,
							'type': "POST",
							'global': false,
							'dataType': 'html',
							'url': Flask.url_for("simbg_list", {pbgid : idPBG}),
							'success': function (data) {
								tmp = data;
							}
						});
						return tmp;
					}();

					console.log(data);
					// console.log(Flask.url_for("simbg_list", {pbgid : idPBG}));

					var tableTBody = document.getElementById("table-body");
					var pdfViewer = document.getElementById("pdf-viewer");

					while (tableTBody.firstChild) {
						tableTBody.removeChild(tableTBody.firstChild);
					}
					pdfViewer.setAttribute("src", "");
					// checkedPDFs = new Set();

					// Check if the data is not empty
					if (data && data.length > 0) {
						data.forEach((item, index) => {
							const doc = item.document;
							const size = item.size;
							const sudin = item.sudin;
							const tr = document.createElement("tr");

							const tdIndex = document.createElement("td");
							tdIndex.style = "font-size: small";
							tdIndex.textContent = index + 1;
							tr.appendChild(tdIndex);

							const tdNama = document.createElement("td");
							const pNama = document.createElement("p");
							tdNama.style = "font-size: small";

							const docSpan = document.createElement("span");
							docSpan.style.backgroundColor = "lightgray";
							docSpan.innerText = doc;

							pNama.appendChild(docSpan);
							pNama.appendChild(document.createElement("br"));
							pNama.appendChild(document.createTextNode(size.toString())); // Convert size to string and create a text node
							pNama.appendChild(document.createElement("br"));
							pNama.appendChild(document.createTextNode(sudin)); // Convert sudin to string and create a text node

							tdNama.appendChild(pNama);
							tdNama.addEventListener("click", () =>
								loadPDF(text1, doc, text2, sudin)
							);
							tr.appendChild(tdNama);

							const tdCheckBox = document.createElement("td");
							tdCheckBox.style = "text-align: center";
							const checkbox = document.createElement("input");
							checkbox.type = "checkbox";
							checkbox.style = "width: 15px; height: 15px";
							checkbox.addEventListener("click", () => {
								handleCheckboxClick(doc, checkedPDFs);
								console.log(checkedPDFs);
							});
							tdCheckBox.appendChild(checkbox);
							tr.appendChild(tdCheckBox);

							tableTBody.appendChild(tr);
						});
					} else {
						const trEmpty = document.createElement("tr");
						const tdEmpty = document.createElement("td");
						tdEmpty.style = "text-align: center; font-size: small";
						tdEmpty.colSpan = 3;
						tdEmpty.textContent = "Data Not Found";
						trEmpty.appendChild(tdEmpty);
						tableTBody.appendChild(trEmpty);
						// console.log(urlApi);
						console.log("failed");
						// const test1 = $.getJSON(Flask.url_for("simbg_file_test2")),
						// 						function(data) {
						// 							console.log(test1)
						// 						});
						// const test11 = $.getJSON(Flask.url_for("simbg_file_test2"));
						// const test11 = $.get(Flask.url_for("simbg_file_test2"));
						// const test1 = href=/apijakartasatu/simbg_file_test2;
						// const test1 = $.getJSON((/apijakartasatu/simbg_file_test2))
						$.ajax({
								type: "GET",
								url: Flask.url_for("simbg_file_test2", {datatest : "from ajax"}),
								contentType: "text/plain",
								dataType: "text",
								success: function (data) {
									console.log(data);
									test2(data);						
								}
								});

						function test2(test2) {
								console.log(test2);

						}
						

						// console.log(test11);
						// console.log("API response is empty or invalid");
						// console.log("failed");

					}
				} catch (error) {
					console.error("An error occurred during the fetch:", error);
					// console.log("failed");
				}
			}
			api(checkedPDFs);
		});

		const submitButton = document.getElementById("submit-button");
		submitButton.addEventListener("click", () => {
			const sideTable = document.getElementById("sideTable");
			let link = printCheckedPDFs(checkedPDFs);
			console.log(document.getElementById("list-input").value);
			getData(link);
			link = "";
			checkedPDFs.clear();
		});

		// Function to handle checkbox click
		function handleCheckboxClick(doc, checkedPDFs) {
			if (checkedPDFs.has(doc)) {
				checkedPDFs.delete(doc);
			} else {
				checkedPDFs.add(doc);
			}
		}

		// Function to clear the content of the tbody and the iframe
		function clearTableBody(checkedPDFs) {
			var tableTBody = document.getElementById("table-body");
			var pdfViewer = document.getElementById("pdf-viewer");

			while (tableTBody.firstChild) {
				tableTBody.removeChild(tableTBody.firstChild);
			}
			pdfViewer.setAttribute("src", "");
			checkedPDFs.clear();
		}

		//Function Submit Button
		function printCheckedPDFs(checkedPDFs) {
			const text3 =
				"http://10.1.2.103///apijakartasatu/web-dev/simbg-file/submit?pbgid=pbg-317101-01032023-01&list=[";
			const text4 = Array.from(checkedPDFs).join(",");
			console.log(text4);
			const postLink = text3 + text4 + "]";
			console.log(checkedPDFs);
			document.getElementById("list-input").value = text4;
			return postLink;
		}

		//Function Get Status from post
		function getData(link) {
			console.log(link);
			fetch(link)
				.then((res) => {
					// Check if the response is successful (status 200-299)
					if (res.ok) {
						// Check the content type of the response
						const contentType = res.headers.get("content-type");
						if (contentType && contentType.includes("application/json")) {
							// If the response is JSON, parse it as JSON
							return res.json();
						} else {
							// If the response is not JSON, treat it as plain text
							return res.text();
						}
					} else {
						// If the response is not successful, handle the error
						throw new Error("Failed to fetch data.");
					}
				})
				.then((data) => {
					// Check if the data is valid JSON
					if (typeof data === "object") {
						// Data is JSON
						console.log(data);
					} else {
						// Data is plain text
						console.log("Non-JSON response:", data);
						clearTableBody(checkedPDFs);
						var tableTBody = document.getElementById("table-body");
						const trSuccess = document.createElement("tr");
						const tdSuccess = document.createElement("td");
						tdSuccess.style = "text-align: center; font-size: small";
						tdSuccess.colSpan = 3;
						tdSuccess.textContent = "Data Sent!";
						trSuccess.appendChild(tdSuccess);
						tableTBody.appendChild(trSuccess);
					}
				})
				.catch((error) => {
					console.error("An error occurred during the fetch:", error);
				});
		}

		// Function Load PDF using AJAX
		function loadPDF(text1, doc, text2, sudin) {
			const url = text1 + doc + text2 + sudin;

			// Create a new XMLHttpRequest object
			const xhr = new XMLHttpRequest();

			// Configure the XMLHttpRequest
			xhr.open("GET", url, true);
			xhr.responseType = "blob"; // Set the response type to 'blob' to handle binary data

			// Set up the event handler when the request is completed
			xhr.onload = function () {
				if (xhr.status === 200) {
					// Convert the response to a blob
					const blob = xhr.response;

					// Convert the blob to a URL
					const blobURL = URL.createObjectURL(blob);

					// Set the 'src' attribute of the iframe to the blob URL
					const pdfViewer = document.getElementById("pdf-viewer");
					pdfViewer.setAttribute("src", blobURL);
				}
			};

			// Send the request
			xhr.send();
		}
	};

	function zoom() {
		document.body.style.zoom = "80%";
	}
</script>